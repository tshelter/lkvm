<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remote Control</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: black;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
<video id="video" autoplay playsinline></video>
<script>
    const video = document.getElementById('video');
    const socket = new WebSocket(`ws://${window.location.host}/ws`);

    async function initializeCamera() {
        try {
            video.srcObject = await navigator.mediaDevices.getUserMedia({video: true});
            video.addEventListener('loadedmetadata', () => {
                video.width = video.videoWidth;
                video.height = video.videoHeight;
            });
        } catch (error) {
            console.error('Error accessing the camera:', error);
        }
    }

    initializeCamera();

    function getEventCoordinates(event) {
        const rect = video.getBoundingClientRect();
        const realWidth = video.videoWidth;
        const realHeight = video.videoHeight;
        const x = Math.round((event.clientX - rect.left) * (realWidth / rect.width));
        const y = Math.round((event.clientY - rect.top) * (realHeight / rect.height));
        return {x, y};
    }

    video.addEventListener('mousemove', (event) => {
        const {x, y} = getEventCoordinates(event);
        socket.send(JSON.stringify({type: 'mousemove', x, y}));
    });

    video.addEventListener('mousedown', (event) => {
        const {x, y} = getEventCoordinates(event);
        socket.send(JSON.stringify({type: 'mousedown', x, y}));
    });

    document.addEventListener('keydown', (event) => {
        socket.send(JSON.stringify({type: 'keydown', key: event.keyCode}));
    });
</script>
</body>
</html>
